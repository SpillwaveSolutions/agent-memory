---
phase: 19-opencode-commands-and-skills
plan: 04
type: execute
wave: 2
depends_on: ["19-01", "19-02", "19-03"]
files_modified:
  - plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md
autonomous: true

must_haves:
  truths:
    - "Agent is discoverable by OpenCode via file-based discovery"
    - "Agent has valid YAML frontmatter with description, mode, tools, and permission"
    - "Agent references all five skills in body content"
    - "Trigger patterns are documented in body (not in triggers: field)"
  artifacts:
    - path: "plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md"
      provides: "Memory navigator agent definition"
      contains: "mode: subagent"
  key_links:
    - from: "plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md"
      to: "skills"
      via: "## Skills Used section"
      pattern: "memory-query|topic-graph|bm25-search|vector-search"
---

<objective>
Create OpenCode memory-navigator agent with appropriate format adaptations.

Purpose: Enable OpenCode users to invoke memory-navigator for intelligent retrieval
Output: Agent file in `.opencode/agents/` directory
</objective>

<execution_context>
@/Users/richardhightower/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-opencode-commands-and-skills/19-RESEARCH.md
@plugins/memory-query-plugin/agents/memory-navigator.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create memory-navigator agent</name>
  <files>plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md</files>
  <action>
Create agent file with OpenCode-specific format.

Key adaptations from Claude Code format:
1. **Remove `triggers:` field** - OpenCode agents don't support triggers
2. **Remove `skills:` array from frontmatter** - Skills are referenced in body only
3. **Add `mode: subagent`** - This agent runs as a subagent, not primary
4. **Add `tools:` section** - Specify allowed tools (read, bash only)
5. **Add `permission:` section** - Restrict bash to memory-daemon commands

OpenCode frontmatter format:
```yaml
---
description: Autonomous agent for intelligent memory retrieval with tier-aware routing, intent classification, and automatic fallback chains
mode: subagent
tools:
  read: true
  bash: true
  write: false
  edit: false
permission:
  bash:
    "memory-daemon *": allow
    "grep *": allow
    "*": deny
---
```

Body content adaptations:
1. In "When to Use" section, change "This agent activates" to "Invoke this agent (@memory-navigator)"
2. Add note about explicit @mention invocation since triggers aren't supported
3. Keep all Capabilities, Process, Output Format, and Examples sections
4. Reference skills by name in body (already present in Skills Used section)

Document the original trigger patterns in a "Trigger Patterns" or "When to Invoke" section so users know what queries should trigger @memory-navigator:
- "what (did|were) we (discuss|talk|work)"
- "(remember|recall|find).*(conversation|discussion|session)"
- "(last|previous|earlier) (session|conversation|time)"
- "context from (last|previous|yesterday|last week)"
- "(explore|discover|browse).*(topics|themes|patterns)"
  </action>
  <verify>
```bash
head -30 plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md
# Should show mode: subagent, tools:, permission:, no triggers:
```
  </verify>
  <done>memory-navigator agent created with OpenCode format</done>
</task>

</tasks>

<verification>
```bash
# Check agent file exists
ls -la plugins/memory-opencode-plugin/.opencode/agents/

# Verify frontmatter structure
head -20 plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md

# Verify no triggers: field (OpenCode doesn't support it)
grep "^triggers:" plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md && echo "ERROR: triggers field found" || echo "OK: no triggers field"

# Verify mode: subagent
grep "mode:" plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md

# Verify skills are referenced in body
grep -E "(memory-query|topic-graph|bm25-search|vector-search)" plugins/memory-opencode-plugin/.opencode/agents/memory-navigator.md | head -5
```
</verification>

<success_criteria>
- Agent file created at `.opencode/agents/memory-navigator.md`
- Frontmatter contains: description, mode, tools, permission
- No `triggers:` field in frontmatter (OpenCode doesn't support it)
- Body documents when to invoke @memory-navigator
- Skills referenced in body content
- Bash permissions restricted to memory-daemon commands
</success_criteria>

<output>
After completion, create `.planning/phases/19-opencode-commands-and-skills/19-04-SUMMARY.md`
</output>
