# Plan 09-03: Installation Automation

## Metadata

```yaml
phase: 9
plan: 03
wave: 2
depends_on: [09-01]
files_modified:
  - plugins/memory-setup-plugin/skills/memory-setup/references/installation-methods.md (update)
  - plugins/memory-setup-plugin/skills/memory-setup/references/platform-specifics.md (update)
  - plugins/memory-setup-plugin/skills/memory-setup/scripts/install-helper.sh
autonomous: true
```

## Objective

Document and implement the installation automation that the setup wizard executes, including binary installation, configuration file generation, and auto-start setup.

## Context

Installation must:
- Work across macOS, Linux, and Windows
- Handle multiple installation methods
- Generate correct configuration files
- Set up auto-start appropriately for each platform
- Be reversible (uninstall path)

## Tasks

### Task 1: Document Cargo Installation

```xml
<task id="1">
  <title>Document cargo install method</title>
  <description>
    Update installation-methods.md with cargo install details:

    Prerequisites:
    - Rust toolchain (rustup recommended)
    - C compiler (for RocksDB)

    Commands:
    ```bash
    # Install from crates.io (when published)
    cargo install memory-daemon memory-ingest

    # Install from git (current)
    cargo install --git https://github.com/SpillwaveSolutions/agent-memory memory-daemon
    cargo install --git https://github.com/SpillwaveSolutions/agent-memory memory-ingest
    ```

    Verification:
    ```bash
    memory-daemon --version
    memory-ingest --version
    ```

    Troubleshooting:
    - RocksDB compilation errors
    - Missing C compiler
    - Permission issues
  </description>
  <acceptance>
    - Commands are copy-paste ready
    - Prerequisites clearly stated
    - Common errors addressed
  </acceptance>
</task>
```

### Task 2: Document Binary Download Installation

```xml
<task id="2">
  <title>Document pre-built binary installation</title>
  <description>
    Add binary download section to installation-methods.md:

    GitHub Releases URL pattern:
    ```
    https://github.com/SpillwaveSolutions/agent-memory/releases/latest/download/
      memory-daemon-{os}-{arch}
      memory-ingest-{os}-{arch}
    ```

    Platform detection:
    ```bash
    OS=$(uname -s | tr '[:upper:]' '[:lower:]')
    ARCH=$(uname -m)
    # Map arch: x86_64 -> amd64, arm64 -> arm64
    ```

    Download and install:
    ```bash
    # macOS/Linux
    curl -L -o memory-daemon "https://github.com/.../${OS}-${ARCH}"
    chmod +x memory-daemon
    mv memory-daemon ~/.local/bin/

    # Windows (PowerShell)
    Invoke-WebRequest -Uri "https://github.com/..." -OutFile memory-daemon.exe
    Move-Item memory-daemon.exe $env:USERPROFILE\.local\bin\
    ```

    Checksum verification:
    ```bash
    curl -L -o checksums.txt "https://github.com/.../checksums.txt"
    sha256sum -c checksums.txt
    ```
  </description>
  <acceptance>
    - URLs use correct pattern
    - Platform detection works
    - Checksum verification included
  </acceptance>
</task>
```

### Task 3: Document Configuration Generation

```xml
<task id="3">
  <title>Document configuration file generation</title>
  <description>
    Add configuration generation section to configuration-options.md:

    config.toml generation:
    ```bash
    mkdir -p ~/.config/agent-memory

    cat > ~/.config/agent-memory/config.toml << 'EOF'
    [daemon]
    port = 50051
    db_path = "~/.local/share/agent-memory/db"

    [summarizer]
    provider = "${PROVIDER}"
    model = "${MODEL}"
    EOF
    ```

    hooks.yaml generation (global):
    ```bash
    cat >> ~/.claude/hooks.yaml << 'EOF'

    # Agent Memory event capture
    hooks:
      - event: "*"
        run: "~/.local/bin/memory-ingest"
    EOF
    ```

    hooks.yaml generation (project):
    ```bash
    cat > .claude/hooks.yaml << 'EOF'
    hooks:
      - event: "*"
        run: "~/.local/bin/memory-ingest"
    EOF
    ```

    Database directory:
    ```bash
    mkdir -p ~/.local/share/agent-memory/db
    ```
  </description>
  <acceptance>
    - Config templates are complete
    - Variable substitution documented
    - Directory creation included
  </acceptance>
</task>
```

### Task 4: Document Auto-Start Setup

```xml
<task id="4">
  <title>Document platform-specific auto-start setup</title>
  <description>
    Update platform-specifics.md with auto-start configuration:

    macOS (launchd):
    ```bash
    cat > ~/Library/LaunchAgents/com.spillwave.memory-daemon.plist << 'EOF'
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" ...>
    <plist version="1.0">
    <dict>
        <key>Label</key>
        <string>com.spillwave.memory-daemon</string>
        <key>ProgramArguments</key>
        <array>
            <string>~/.local/bin/memory-daemon</string>
            <string>start</string>
        </array>
        <key>RunAtLoad</key>
        <true/>
        <key>KeepAlive</key>
        <true/>
    </dict>
    </plist>
    EOF

    launchctl load ~/Library/LaunchAgents/com.spillwave.memory-daemon.plist
    ```

    Linux (systemd user service):
    ```bash
    mkdir -p ~/.config/systemd/user

    cat > ~/.config/systemd/user/memory-daemon.service << 'EOF'
    [Unit]
    Description=Agent Memory Daemon
    After=network.target

    [Service]
    ExecStart=%h/.local/bin/memory-daemon start
    Restart=always
    RestartSec=10

    [Install]
    WantedBy=default.target
    EOF

    systemctl --user daemon-reload
    systemctl --user enable memory-daemon
    systemctl --user start memory-daemon
    ```

    Windows (Task Scheduler):
    ```powershell
    $action = New-ScheduledTaskAction -Execute "$env:USERPROFILE\.local\bin\memory-daemon.exe" -Argument "start"
    $trigger = New-ScheduledTaskTrigger -AtLogOn
    $settings = New-ScheduledTaskSettingsSet -RestartCount 3 -RestartInterval (New-TimeSpan -Minutes 1)
    Register-ScheduledTask -TaskName "AgentMemoryDaemon" -Action $action -Trigger $trigger -Settings $settings
    ```
  </description>
  <acceptance>
    - All three platforms covered
    - Commands are complete and functional
    - Restart on failure configured
  </acceptance>
</task>
```

### Task 5: Create Install Helper Script

```xml
<task id="5">
  <title>Create install-helper.sh utility script</title>
  <description>
    Create scripts/install-helper.sh with functions:

    ```bash
    #!/bin/bash
    # Agent Memory Installation Helper
    # Used by setup wizard for common operations

    detect_platform() {
      # Returns: macos, linux, windows
    }

    detect_arch() {
      # Returns: amd64, arm64
    }

    check_binary_installed() {
      # Args: binary_name
      # Returns: 0 if found, 1 if not
    }

    get_binary_version() {
      # Args: binary_name
      # Returns: version string
    }

    check_daemon_running() {
      # Returns: 0 if running, 1 if not
    }

    get_daemon_pid() {
      # Returns: PID or empty
    }

    check_port_available() {
      # Args: port
      # Returns: 0 if available, 1 if in use
    }

    install_binary_cargo() {
      # Args: package_name
      # Installs via cargo
    }

    install_binary_download() {
      # Args: binary_name
      # Downloads from GitHub releases
    }

    setup_autostart() {
      # Sets up platform-appropriate auto-start
    }

    remove_autostart() {
      # Removes auto-start configuration
    }
    ```
  </description>
  <acceptance>
    - All functions documented
    - Cross-platform support
    - Error handling included
  </acceptance>
</task>
```

### Task 6: Document Uninstall Process

```xml
<task id="6">
  <title>Document uninstall/cleanup process</title>
  <description>
    Add uninstall section to installation-methods.md:

    Stop daemon:
    ```bash
    memory-daemon stop
    # or
    pkill memory-daemon
    ```

    Remove auto-start:
    ```bash
    # macOS
    launchctl unload ~/Library/LaunchAgents/com.spillwave.memory-daemon.plist
    rm ~/Library/LaunchAgents/com.spillwave.memory-daemon.plist

    # Linux
    systemctl --user stop memory-daemon
    systemctl --user disable memory-daemon
    rm ~/.config/systemd/user/memory-daemon.service

    # Windows
    Unregister-ScheduledTask -TaskName "AgentMemoryDaemon" -Confirm:$false
    ```

    Remove binaries:
    ```bash
    rm ~/.local/bin/memory-daemon
    rm ~/.local/bin/memory-ingest
    ```

    Remove configuration (optional):
    ```bash
    rm -rf ~/.config/agent-memory
    ```

    Remove data (optional - destructive):
    ```bash
    rm -rf ~/.local/share/agent-memory
    ```

    Remove hooks:
    ```bash
    # Edit ~/.claude/hooks.yaml and remove memory-ingest entries
    ```
  </description>
  <acceptance>
    - Complete uninstall path documented
    - Data preservation vs deletion choices
    - Platform-specific commands
  </acceptance>
</task>
```

## Verification

```yaml
verification:
  - [ ] Cargo installation documented with troubleshooting
  - [ ] Binary download documented with checksums
  - [ ] Configuration generation templates complete
  - [ ] Auto-start setup for macOS, Linux, Windows
  - [ ] Helper script covers common operations
  - [ ] Uninstall process documented
```

## Must-Haves (Goal-Backward)

For Phase 9 success, this plan must deliver:
1. Working installation commands for cargo and binary download
2. Configuration file templates that generate valid config
3. Auto-start setup for all major platforms
4. Reversible installation (clean uninstall path)
