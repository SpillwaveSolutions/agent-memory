---
phase: 22-copilot-cli-adapter
plan: 03
type: execute
wave: 2
depends_on: ["22-01", "22-02"]
files_modified:
  - plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md
  - plugins/memory-copilot-adapter/README.md
  - plugins/memory-copilot-adapter/.gitignore
autonomous: true

must_haves:
  truths:
    - "Install skill can auto-detect Copilot CLI presence and warn if not found"
    - "Install skill copies hook config and script to target project's .github/hooks/ directory"
    - "Install skill copies skills to .github/skills/ or ~/.copilot/skills/ depending on install mode"
    - "Install skill copies navigator agent to .github/agents/ or ~/.copilot/agents/"
    - "Install skill does NOT modify settings.json (Copilot hooks use standalone .github/hooks/*.json, not settings.json)"
    - "README documents complete installation, usage, event capture, skills, agent, and troubleshooting"
    - "README documents the AssistantResponse gap (no assistant text capture in Copilot)"
    - "README documents the sessionStart per-prompt bug and how the adapter handles it"
    - "README documents per-project vs plugin installation (no global hooks)"
    - "Both automated install skill AND manual documentation are provided"
  artifacts:
    - path: "plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md"
      provides: "Automated installation skill for Copilot CLI integration"
      min_lines: 100
    - path: "plugins/memory-copilot-adapter/README.md"
      provides: "Complete adapter documentation"
      min_lines: 150
    - path: "plugins/memory-copilot-adapter/.gitignore"
      provides: "Git ignore for adapter plugin"
      min_lines: 1
  key_links:
    - from: "plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md"
      to: "plugins/memory-copilot-adapter/.github/hooks/scripts/memory-capture.sh"
      via: "copies hook script to target project"
      pattern: "memory-capture\\.sh"
    - from: "plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md"
      to: "plugins/memory-copilot-adapter/.github/hooks/memory-hooks.json"
      via: "copies hook config to target project"
      pattern: "memory-hooks\\.json"
    - from: "plugins/memory-copilot-adapter/README.md"
      to: "plugins/memory-copilot-adapter/.github/"
      via: "documents all adapter components"
      pattern: "\\.github/"
---

<objective>
Create the install skill for automated Copilot CLI setup and the README with comprehensive documentation. The install skill copies hook config, hook script, skills, and navigator agent to the target project. Unlike Gemini's install skill, Copilot's does NOT merge settings.json -- hooks are standalone JSON files in `.github/hooks/`.

Purpose: Provide both automated and manual installation paths for the Copilot CLI adapter. Also document Copilot-specific gaps (no AssistantResponse, no global hooks, sessionStart per-prompt bug) and how the adapter handles them.

Output: Install skill SKILL.md + README.md + .gitignore
</objective>

<execution_context>
@/Users/richardhightower/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-copilot-cli-adapter/22-RESEARCH.md
@.planning/phases/22-copilot-cli-adapter/22-01-SUMMARY.md
@.planning/phases/22-copilot-cli-adapter/22-02-SUMMARY.md
@plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md
@plugins/memory-gemini-adapter/README.md
@plugins/memory-opencode-plugin/README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create memory-copilot-install skill</name>
  <files>plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md</files>
  <action>
Create an install skill that automates Copilot CLI adapter setup. This skill is invoked by the user inside Copilot CLI to self-install the memory integration. Follow the pattern of the Gemini install skill but adapt for Copilot's DIFFERENT hook system.

**CRITICAL DIFFERENCE from Gemini:** Copilot hooks are standalone `.github/hooks/*.json` files, NOT merged into settings.json. The install skill copies the hook config file instead of merging. Also, Copilot has no global hooks (Issue #1157 open) so the install is per-project OR via `/plugin install`.

The SKILL.md must have YAML frontmatter:
```yaml
---
name: memory-copilot-install
description: |
  Install and configure agent-memory integration for GitHub Copilot CLI. Use when asked to "install memory", "setup agent memory", "configure memory hooks", "enable memory capture", or "install copilot memory adapter". Automates hook configuration, skill deployment, agent setup, and verification.
license: MIT
metadata:
  version: 2.1.0
  author: SpillwaveSolutions
---
```

The skill body should instruct Copilot to perform these steps:

**Step 1: Prerequisites check**
- Check if `copilot` CLI is available: `command -v copilot`
- Check Copilot CLI version: `copilot --version`. Note minimum version required for hook support (v0.0.383+, but prefer v0.0.406+ for plugin support).
- Check if `memory-daemon` is available
- Check if `memory-ingest` is available
- Check if `jq` is available (required for hook handler)
- Check jq version (1.6+ needed for `walk` function used in redaction; warn if older)
- Warn user for each missing prerequisite with installation guidance

**Step 2: Determine install mode**
Two modes:
- **Per-project (default):** Copy files to `.github/` in the current project directory
- **Plugin install:** User runs `/plugin install /path/to/adapter` -- the plugin system handles discovery

Ask user which mode they prefer. Default to per-project.

**Step 3: Create directories (per-project mode)**
```bash
mkdir -p .github/hooks/scripts
mkdir -p .github/skills
mkdir -p .github/agents
```

**Step 4: Copy hook files**
- Copy `memory-hooks.json` to `.github/hooks/memory-hooks.json`
- Copy `memory-capture.sh` to `.github/hooks/scripts/memory-capture.sh`
- Make script executable: `chmod +x .github/hooks/scripts/memory-capture.sh`

NOTE: Do NOT modify settings.json. Copilot hooks use standalone JSON files, not settings.json.

**Step 5: Copy skills**
- Copy all skill directories from adapter's `.github/skills/` to project's `.github/skills/`
- Exclude the install skill itself (no need to install the installer)
- Skills to copy: memory-query, retrieval-policy, topic-graph, bm25-search, vector-search

**Step 6: Copy navigator agent**
- Copy `memory-navigator.agent.md` to `.github/agents/memory-navigator.agent.md`

**Step 7: Verify installation**
- Check hook config exists and is valid JSON
- Check hook script exists and is executable
- Check skills exist (ls .github/skills/memory-query/SKILL.md etc.)
- Check agent exists
- If memory-daemon is running, test connectivity: `memory-daemon status`

**Step 8: Report results**
- List what was installed with file paths
- Show warnings for missing prerequisites
- Note: "Per-project installation means hooks only fire in THIS project directory. For other projects, re-run the install skill or use `/plugin install`."
- Note gaps: "AssistantResponse events are not captured (Copilot CLI does not provide this hook). SubagentStart/SubagentStop are also not available."
- Suggest testing: "Start a new Copilot session in this project and verify events are captured."

Include a "When Not to Use" section.
Include an "Uninstall" section with commands to remove installed files.
Include a "Plugin Install Alternative" section explaining `/plugin install` as an alternative to per-project copying.
  </action>
  <verify>
1. `test -f plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md`
2. `head -5 plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md` shows YAML frontmatter with `name: memory-copilot-install`
3. File contains "Prerequisites" or "prerequisite"
4. File contains "memory-hooks.json" (hook config copying, NOT settings.json merge)
5. File does NOT contain "settings.json merge" or "merge.*settings" (Copilot does not use settings.json for hooks)
6. File contains "chmod" (making script executable)
7. File contains ".agent.md" (agent file copying)
8. File contains "Uninstall" or "uninstall"
9. File contains "plugin install" or "/plugin" (plugin install alternative)
10. `wc -l plugins/memory-copilot-adapter/.github/skills/memory-copilot-install/SKILL.md` shows 100+ lines
  </verify>
  <done>
Install skill SKILL.md exists with prerequisites check (Copilot CLI version, memory-daemon, memory-ingest, jq version), per-project directory creation, hook config+script copying (NOT settings.json merge), skill copying, agent copying, verification, uninstall instructions, and plugin install alternative.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create README.md and .gitignore</name>
  <files>
    plugins/memory-copilot-adapter/README.md
    plugins/memory-copilot-adapter/.gitignore
  </files>
  <action>
Create comprehensive README.md documentation and .gitignore for the Copilot CLI adapter. Follow the structure of the Gemini adapter README but adapt for Copilot-specific details.

**README.md structure:**

1. **Title and overview:** "Memory Adapter for GitHub Copilot CLI" -- enables intelligent memory retrieval and automatic event capture in Copilot CLI
2. **Version:** 2.1.0
3. **Quickstart snippet:**
   ```bash
   # Option A: Plugin install (recommended)
   copilot /plugin install /path/to/plugins/memory-copilot-adapter

   # Option B: Per-project install (run inside Copilot CLI)
   # Copy install skill, then ask Copilot to "install agent memory"
   mkdir -p .github/skills
   cp -r plugins/memory-copilot-adapter/.github/skills/memory-copilot-install .github/skills/

   # Verify capture (after a Copilot session):
   memory-daemon query root
   memory-daemon retrieval route "your topic" --agent copilot
   ```
4. **Compatibility:** Copilot CLI v0.0.383+ (hooks), v0.0.406+ recommended (plugin support). Pin version.
5. **Prerequisites:** memory-daemon installed and running, Copilot CLI >= v0.0.383, jq >= 1.6 (for redaction), memory-ingest on PATH
6. **Installation:**
   - **Plugin install (recommended):** `/plugin install /path/to/adapter` or from GitHub URL. The plugin system auto-discovers hooks, skills, and agents.
   - **Per-project:** Use the install skill (copy to `.github/skills/`, ask Copilot to "install agent memory")
   - **Manual per-project:** Copy `.github/hooks/`, `.github/skills/`, `.github/agents/` to project root
   - Note: NO global install option. Copilot CLI does not support global hooks (Issue #1157 open). Each project needs its own installation.
7. **Skills:** Table of all 6 skills (memory-query, retrieval-policy, topic-graph, bm25-search, vector-search, memory-copilot-install) with purpose and auto-activation description. Explain that skills auto-activate when the user's prompt matches the skill description.
8. **Navigator Agent:** Describe the memory-navigator agent. Explain invocation via `/agent memory-navigator` or auto-inference (infer: true). List capabilities: tier routing, intent classification, fallback chains, explainability.
9. **Retrieval Tiers:** Table of 5 tiers with capabilities (same as other adapters)
10. **Event Capture:**
    - How it works: Hook handler script captures 5 lifecycle events
    - Session ID synthesis: Explain that Copilot does not provide session_id and the adapter generates one via temp file
    - Event mapping table: Copilot Event -> Agent Memory Event -> Mapping Quality
    - Gaps: (a) No AssistantResponse -- assistant text responses NOT captured. postToolUse's textResultForLlm provides partial coverage. (b) No SubagentStart/SubagentStop. (c) sessionStart may fire per-prompt (Bug #991) -- adapter handles gracefully by reusing session IDs.
    - Behavior: Fail-open, backgrounded, agent:copilot tagging
    - Verifying capture
11. **Architecture:** Directory tree of the plugin (including plugin.json, .github/hooks/, .github/skills/, .github/agents/)
12. **Copilot CLI vs Other Adapters:** Comparison table showing differences from Gemini and Claude Code adapters:
    - Hook config: standalone JSON vs settings.json merge
    - Commands: skills only vs TOML + skills
    - Agent: proper .agent.md vs embedded in skill
    - Global install: not available vs available
    - Session ID: synthesized vs provided
    - Assistant response: not captured vs captured
13. **Troubleshooting:**
    - Daemon not running
    - No results found
    - Hooks not firing (check .github/hooks/ exists in project root, check Copilot version >= v0.0.383)
    - Sessions fragmented (Bug #991 workaround -- adapter handles this)
    - jq not installed or too old (need 1.6+ for redaction)
    - No global hooks (per-project only -- use plugin install for convenience)
    - ANSI codes in output (adapter strips automatically)
    - toolArgs parsing errors (adapter handles double-parse)
    - Assistant responses missing (expected gap -- documented)
14. **Cross-Agent Queries:** Show how to search across all agents
15. **Related:** Links to agent-memory, Gemini adapter, OpenCode plugin
16. **Version History:** v2.1.0 -- Initial release
17. **License:** MIT

**.gitignore:**
```
# OS files
.DS_Store
Thumbs.db

# Editor files
*.swp
*.swo
*~
.idea/
.vscode/
```
  </action>
  <verify>
1. `test -f plugins/memory-copilot-adapter/README.md`
2. `test -f plugins/memory-copilot-adapter/.gitignore`
3. README contains "Copilot" (adapter name)
4. README contains "Installation" (install section)
5. README contains "Event Capture" (capture section)
6. README contains "Troubleshooting" (troubleshooting section)
7. README contains "AssistantResponse" or "assistant response" (gap documentation)
8. README contains "session_id" or "Session ID" (session ID synthesis documentation)
9. README contains "Bug #991" or "#991" or "per-prompt" (per-prompt bug documentation)
10. README contains "plugin install" or "/plugin" (plugin install documentation)
11. README contains "cross-agent" or "Cross-Agent" (cross-agent queries)
12. README contains "Quick" or "quickstart" (quickstart snippet)
13. README contains "version" or "Version" (version pin / compatibility)
14. README contains ".agent.md" (navigator agent documentation)
15. `wc -l plugins/memory-copilot-adapter/README.md` shows 150+ lines
16. .gitignore contains ".DS_Store"
  </verify>
  <done>
README.md provides complete documentation covering installation (plugin + per-project + manual), skills, navigator agent, retrieval tiers, event capture with mapping table and gap documentation (AssistantResponse, per-prompt bug, no global hooks), architecture, adapter comparison, troubleshooting, and cross-agent queries. .gitignore covers OS and editor files.
  </done>
</task>

</tasks>

<verification>
- Install skill provides per-project setup (NOT settings.json merge -- Copilot uses standalone hook files)
- Install skill copies hook config, hook script, skills, and navigator agent
- Install skill checks prerequisites including jq version
- README covers all sections: install, skills, agent, tiers, event capture, troubleshooting
- README documents all Copilot-specific gaps (AssistantResponse, no global hooks, per-prompt bug)
- README includes adapter comparison table with Gemini and Claude Code
- .gitignore exists with standard patterns
</verification>

<success_criteria>
- Install skill is comprehensive and can be used by Copilot to self-install the memory integration
- README matches the quality and structure of the Gemini adapter README
- Both plugin install and per-project installation paths are documented
- All Copilot-specific gaps and quirks are documented
- .gitignore exists
</success_criteria>

<output>
After completion, create `.planning/phases/22-copilot-cli-adapter/22-03-SUMMARY.md`
</output>
