---
phase: 21-gemini-cli-adapter
plan: 03
type: execute
wave: 2
depends_on: ["21-01", "21-02"]
files_modified:
  - plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md
  - plugins/memory-gemini-adapter/README.md
  - plugins/memory-gemini-adapter/.gitignore
autonomous: true

must_haves:
  truths:
    - "Install skill can auto-detect Gemini CLI presence and warn if not found"
    - "Install skill writes hook configuration by merging into existing settings.json (not overwriting)"
    - "Install skill copies hook script to ~/.gemini/hooks/ and makes it executable"
    - "README documents complete installation, usage, event capture, commands, skills, and troubleshooting"
    - "Both automated install skill AND manual documentation are provided"
  artifacts:
    - path: "plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md"
      provides: "Automated installation skill for Gemini CLI integration"
      min_lines: 100
    - path: "plugins/memory-gemini-adapter/README.md"
      provides: "Complete adapter documentation"
      min_lines: 150
    - path: "plugins/memory-gemini-adapter/.gitignore"
      provides: "Git ignore for adapter plugin"
      min_lines: 1
  key_links:
    - from: "plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md"
      to: "plugins/memory-gemini-adapter/.gemini/hooks/memory-capture.sh"
      via: "copies hook script to ~/.gemini/hooks/"
      pattern: "memory-capture\\.sh"
    - from: "plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md"
      to: "plugins/memory-gemini-adapter/.gemini/settings.json"
      via: "merges hook config into user's settings.json"
      pattern: "settings\\.json"
---

<objective>
Create the install skill for automated Gemini CLI setup and the README with comprehensive documentation. The install skill auto-detects Gemini CLI, copies the hook script, merges hook configuration into settings.json, and copies commands and skills.

Purpose: Provide both automated and manual installation paths for the Gemini CLI adapter. The install skill follows the same pattern as the Claude Code setup installer.

Output: Install skill SKILL.md + README.md + .gitignore
</objective>

<execution_context>
@/Users/richardhightower/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-gemini-cli-adapter/21-RESEARCH.md
@.planning/phases/21-gemini-cli-adapter/21-01-SUMMARY.md
@.planning/phases/21-gemini-cli-adapter/21-02-SUMMARY.md
@plugins/memory-opencode-plugin/README.md
@plugins/memory-setup-plugin/skills/memory-setup/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create memory-gemini-install skill</name>
  <files>plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md</files>
  <action>
Create an install skill that automates Gemini CLI adapter setup. This skill is invoked by the user inside Gemini CLI to self-install the memory integration. It follows the pattern of the Claude Code memory-setup plugin.

The SKILL.md must have YAML frontmatter:
```yaml
---
name: memory-gemini-install
description: |
  Install and configure agent-memory integration for Gemini CLI. Use when asked to "install memory", "setup agent memory", "configure memory hooks", or "enable memory capture". Automates hook configuration, skill deployment, and verification.
license: MIT
metadata:
  version: 2.1.0
  author: SpillwaveSolutions
---
```

The skill body should instruct Gemini to perform these steps:

**Step 1: Prerequisites check**
- Check if `gemini` CLI is available: `which gemini` or `command -v gemini`
- Check if `memory-daemon` is available: `which memory-daemon`
- Check if `memory-ingest` is available: `which memory-ingest`
- Check if `jq` is available: `which jq`
- Warn user for each missing prerequisite with installation guidance
- If Gemini CLI not found, warn but allow continuing (user might be running from a different context)

**Step 2: Create directories**
- `mkdir -p ~/.gemini/hooks`
- `mkdir -p ~/.gemini/commands`
- `mkdir -p ~/.gemini/skills`

**Step 3: Copy hook handler script**
- Copy `memory-capture.sh` from the adapter's `.gemini/hooks/` to `~/.gemini/hooks/memory-capture.sh`
- Make it executable: `chmod +x ~/.gemini/hooks/memory-capture.sh`

**Step 4: Merge hook configuration into settings.json**
- CRITICAL: Do NOT overwrite existing settings.json -- MERGE hook entries
- Read existing `~/.gemini/settings.json` if it exists (or start with `{}`)
- Use `jq` to merge the hook configuration from the adapter's settings.json template
- The merge strategy: for each hook event type, append the memory-capture hook to the existing array (or create the array if it does not exist)
- Provide the exact jq command for merging:
  ```bash
  # Read existing settings or start empty
  EXISTING=$(cat ~/.gemini/settings.json 2>/dev/null || echo '{}')
  # Read hook template
  HOOKS=$(cat /path/to/adapter/.gemini/settings.json | jq '.hooks')
  # Merge: for each event, add hooks if not already present
  echo "$EXISTING" | jq --argjson hooks "$HOOKS" '.hooks = (.hooks // {}) * $hooks' > ~/.gemini/settings.json
  ```
- After merge, validate the result is valid JSON: `jq . ~/.gemini/settings.json > /dev/null`

**Step 5: Copy commands**
- Copy all `.toml` files from the adapter's `.gemini/commands/` to `~/.gemini/commands/`

**Step 6: Copy skills**
- Copy all skill directories from the adapter's `.gemini/skills/` to `~/.gemini/skills/`
- Exclude the install skill itself (no need to install the installer)

**Step 7: Verify installation**
- Check hook script exists and is executable
- Check settings.json contains memory-capture hooks
- Check commands exist: `ls ~/.gemini/commands/memory-*.toml`
- Check skills exist: `ls ~/.gemini/skills/memory-query/SKILL.md`
- If memory-daemon is running, attempt a test: `memory-daemon status`

**Step 8: Report results**
- List what was installed
- Show any warnings (missing prerequisites)
- Suggest testing: "Start a new Gemini session and check that events are being captured"
- Note: SubagentStart/SubagentStop events have no Gemini equivalent (documented gap)

Include a "When Not to Use" section: Not for querying memories (use /memory-search), not for Claude Code setup (use memory-setup plugin), not for OpenCode setup (use OpenCode plugin).

Include an "Uninstall" section with commands to remove the installed files and clean hooks from settings.json.
  </action>
  <verify>
1. `test -f plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md`
2. `head -5 plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md` shows YAML frontmatter with `name: memory-gemini-install`
3. File contains "Prerequisites" or "prerequisite" (prerequisite check)
4. File contains "settings.json" (settings merge)
5. File contains "merge" or "Merge" (merge strategy, not overwrite)
6. File contains "jq" (JSON manipulation tool)
7. File contains "chmod" (making script executable)
8. File contains "Uninstall" or "uninstall" section
9. `wc -l plugins/memory-gemini-adapter/.gemini/skills/memory-gemini-install/SKILL.md` shows 100+ lines
  </verify>
  <done>
Install skill SKILL.md exists with prerequisites check (Gemini CLI, memory-daemon, memory-ingest, jq), directory creation, hook script copying, settings.json merge (not overwrite), command copying, skill copying, verification, and uninstall instructions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create README.md and .gitignore</name>
  <files>
    plugins/memory-gemini-adapter/README.md
    plugins/memory-gemini-adapter/.gitignore
  </files>
  <action>
Create comprehensive README.md documentation and .gitignore for the Gemini CLI adapter.

**README.md structure (follow the pattern of plugins/memory-opencode-plugin/README.md):**

1. **Title and overview:** "Memory Adapter for Gemini CLI" -- enables intelligent memory retrieval and event capture in Gemini CLI
2. **Version:** 2.1.0
3. **Prerequisites:** memory-daemon installed and running, Gemini CLI installed, jq installed
4. **Installation:**
   - Automated: Use the install skill (copy skills dir to project, then ask Gemini to run install)
   - Manual Global: Copy files to `~/.gemini/`, merge settings.json
   - Manual Per-Project: Copy `.gemini/` directory to project root
5. **Commands:** Table of /memory-search, /memory-recent, /memory-context with descriptions and examples
6. **Skills:** Table of all 6 skills (memory-query, retrieval-policy, topic-graph, bm25-search, vector-search, memory-gemini-install) with purpose and when used
7. **Retrieval Tiers:** Table of 5 tiers with capabilities (same as OpenCode README)
8. **Event Capture:**
   - How it works: Hook handler script captures 6 lifecycle events
   - Event mapping table: Gemini Event -> Agent Memory Event -> Mapping Quality
   - Gap: SubagentStart/SubagentStop not available in Gemini (trivial gap)
   - Behavior: Fail-open, backgrounded, agent:gemini tagging
   - Verifying capture: Commands to check events were captured
9. **Architecture:** Directory tree of the plugin
10. **Troubleshooting:**
    - Daemon not running
    - No results found
    - Hooks not firing (check settings.json structure)
    - Slow responses (check hook backgrounding)
    - stdout pollution (redirect to /dev/null)
    - jq not installed
11. **Related:** Links to agent-memory, memory-query-plugin, memory-opencode-plugin
12. **Version History**
13. **License:** MIT

**Cross-agent query section:** Show how to search across all agents:
```bash
memory-daemon retrieval route "your query"          # All agents
memory-daemon retrieval route "your query" --agent gemini  # Gemini only
```

**.gitignore:**
```
# OS files
.DS_Store
Thumbs.db

# Editor files
*.swp
*.swo
*~
.idea/
.vscode/
```
  </action>
  <verify>
1. `test -f plugins/memory-gemini-adapter/README.md`
2. `test -f plugins/memory-gemini-adapter/.gitignore`
3. README contains "Gemini" (adapter name)
4. README contains "Installation" (install section)
5. README contains "Event Capture" (capture section)
6. README contains "Troubleshooting" (troubleshooting section)
7. README contains "memory-search" (command documentation)
8. README contains "SubagentStart" or "subagent" (gap documentation)
9. README contains "cross-agent" or "Cross-Agent" (cross-agent queries)
10. `wc -l plugins/memory-gemini-adapter/README.md` shows 150+ lines
11. .gitignore contains ".DS_Store"
  </verify>
  <done>
README.md provides complete documentation covering installation (automated + manual), commands, skills, retrieval tiers, event capture with mapping table, architecture, troubleshooting, and cross-agent queries. .gitignore covers OS and editor files.
  </done>
</task>

</tasks>

<verification>
- Install skill provides automated setup with merge (not overwrite) for settings.json
- Install skill checks for Gemini CLI, memory-daemon, memory-ingest, jq prerequisites
- README covers all sections: install, commands, skills, tiers, event capture, troubleshooting
- README documents the SubagentStart/SubagentStop gap
- .gitignore exists with standard patterns
</verification>

<success_criteria>
- Install skill is comprehensive and can be used by Gemini to self-install the memory integration
- README matches the quality and structure of the OpenCode plugin README
- Both automated and manual installation paths are documented
- Gap (SubagentStart/SubagentStop) is documented as trivial
</success_criteria>

<output>
After completion, create `.planning/phases/21-gemini-cli-adapter/21-03-SUMMARY.md`
</output>
