# Plan 07-01: Agentic Memory Query Plugin

**Phase**: 7 - Agentic Memory Plugin
**Status**: ✅ Complete
**Completed**: 2026-01-30

## Goal

Create a Claude Code marketplace plugin that provides natural language commands for querying past conversations from the agent-memory system.

## Context

This plan builds on the Phase 6 end-to-end demo by packaging the query capabilities into a reusable Claude Code plugin with:
- Slash commands for common operations
- An autonomous agent for complex queries
- A spec-compliant skill that scores well on the grading rubric

## Tasks

### Task 1: Create Core Skill ✅

**What**: Create SKILL.md with spec-compliant frontmatter and PDA structure

**Deliverables**:
- `skills/memory-query/SKILL.md` - Core skill definition
- `skills/memory-query/references/command-reference.md` - CLI documentation

**Acceptance Criteria**:
- [x] Valid YAML frontmatter with name and description
- [x] 5+ quoted trigger phrases in description
- [x] Validation checklist with checkboxes
- [x] "When Not to Use" section
- [x] Quick Start table with command examples
- [x] Error handling guidance

### Task 2: Add Slash Commands ✅

**What**: Create command files for /memory-search, /memory-recent, /memory-context

**Deliverables**:
- `commands/memory-search.md` - Topic-based search
- `commands/memory-recent.md` - Recent conversation summaries
- `commands/memory-context.md` - Grip expansion for full context

**Acceptance Criteria**:
- [x] YAML frontmatter with name, description, parameters
- [x] Skills reference to memory-query
- [x] Process section with CLI commands
- [x] Output format template
- [x] Usage examples

### Task 3: Add Autonomous Agent ✅

**What**: Create agent for complex multi-step memory queries

**Deliverables**:
- `agents/memory-navigator.md` - Autonomous agent definition

**Acceptance Criteria**:
- [x] YAML frontmatter with triggers (regex patterns)
- [x] Skills reference to memory-query
- [x] Capabilities documentation
- [x] Process section with multi-step workflow
- [x] Output format template
- [x] Limitations section

### Task 4: Create Plugin Manifest ✅

**What**: Create marketplace.json for plugin registration

**Deliverables**:
- `.claude-plugin/marketplace.json` - Plugin manifest

**Acceptance Criteria**:
- [x] Valid JSON with name, owner, metadata
- [x] Plugins array with skill, commands, agents references
- [x] Correct relative paths to components

### Task 5: Grade and Improve Skill ✅

**What**: Use improving-skills rubric to grade and iterate until score > 95

**Process**:
1. Initial grade: 72/100 (Grade C)
2. Applied improvements:
   - Spec-compliant frontmatter (metadata wrapper for custom fields)
   - Added 5 quoted trigger phrases
   - Added validation checklist
   - Added "When Not to Use" section
3. Final grade: 99/100 (Grade A)

**Score Breakdown**:
| Pillar | Score | Max |
|--------|-------|-----|
| PDA | 27 | 30 |
| Ease of Use | 24 | 25 |
| Spec Compliance | 15 | 15 |
| Writing Style | 10 | 10 |
| Utility | 18 | 20 |
| Base | 94 | 100 |
| Modifiers | +5 | ±15 |
| **Final** | **99** | **100** |

### Task 6: Monorepo Organization ✅

**What**: Reorganize repository with plugins/ directory

**Deliverables**:
- `plugins/memory-query-plugin/` - Complete plugin structure

**Final Structure**:
```
plugins/memory-query-plugin/
├── .claude-plugin/
│   └── marketplace.json
├── skills/
│   └── memory-query/
│       ├── SKILL.md
│       └── references/
│           └── command-reference.md
├── commands/
│   ├── memory-search.md
│   ├── memory-recent.md
│   └── memory-context.md
├── agents/
│   └── memory-navigator.md
├── README.md
└── .gitignore
```

## Dependencies

- Phase 6 complete (memory-daemon query CLI working)
- skill-creator skill for initialization
- improving-skills skill for grading
- creating-plugin-from-skill skill for plugin structure

## Verification

```bash
# Verify plugin structure
ls -la plugins/memory-query-plugin/

# Verify manifest
cat plugins/memory-query-plugin/.claude-plugin/marketplace.json | jq .

# Verify skill
head -20 plugins/memory-query-plugin/skills/memory-query/SKILL.md
```

## Notes

- CCH hook integration (memory-ingest binary) was deferred to Phase 8
- Plugin uses existing memory-daemon query CLI, not direct gRPC
- Skill grading required 2 iterations to achieve > 95 score
