---
id: 15-01
name: memory-storage skill
phase: 15
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - plugins/memory-setup-plugin/skills/memory-storage/SKILL.md
  - plugins/memory-setup-plugin/skills/memory-storage/references/retention-policies.md
  - plugins/memory-setup-plugin/skills/memory-storage/references/gdpr-compliance.md
  - plugins/memory-setup-plugin/skills/memory-storage/references/archive-strategies.md
autonomous: true
estimated_effort: M

must_haves:
  truths:
    - "User can configure storage path via interactive wizard"
    - "User can set retention policy (forever, 90 days, 30 days, 7 days)"
    - "User can configure cleanup schedule (cron-based)"
    - "User can enable/disable GDPR mode"
    - "User can tune performance parameters (buffer size, background jobs)"
    - "State detection skips already-configured options"
  artifacts:
    - path: "plugins/memory-setup-plugin/skills/memory-storage/SKILL.md"
      provides: "Interactive storage wizard skill"
      min_lines: 200
    - path: "plugins/memory-setup-plugin/skills/memory-storage/references/retention-policies.md"
      provides: "Retention policy documentation"
      min_lines: 50
    - path: "plugins/memory-setup-plugin/skills/memory-storage/references/gdpr-compliance.md"
      provides: "GDPR mode documentation"
      min_lines: 40
    - path: "plugins/memory-setup-plugin/skills/memory-storage/references/archive-strategies.md"
      provides: "Archive strategy documentation"
      min_lines: 40
  key_links:
    - from: "plugins/memory-setup-plugin/skills/memory-storage/SKILL.md"
      to: "~/.config/memory-daemon/config.toml"
      via: "config generation heredoc"
      pattern: "\\[storage\\]|\\[retention\\]"
---

<objective>
Create the `/memory-storage` interactive wizard skill for configuring storage paths, data retention policies, cleanup schedules, GDPR compliance mode, and performance tuning.

Purpose: Provide users with guided configuration for storage-related settings that are too advanced for the basic `/memory-setup` wizard but essential for production deployments.

Output: SKILL.md file with 6-step wizard flow plus 3 reference documentation files.
</objective>

<execution_context>
@/Users/richardhightower/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-configuration-wizard-skills/15-RESEARCH.md
@docs/plans/configuration-wizard-skills-plan.md
@plugins/memory-setup-plugin/skills/memory-setup/SKILL.md
@plugins/memory-setup-plugin/skills/memory-setup/references/wizard-questions.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create memory-storage SKILL.md with 6-step wizard</name>
  <files>plugins/memory-setup-plugin/skills/memory-storage/SKILL.md</files>
  <action>
Create the SKILL.md file following the exact pattern from memory-setup/SKILL.md.

**YAML Frontmatter:**
```yaml
---
name: memory-storage
description: |
  This skill should be used when the user asks to "configure storage",
  "set up retention policies", "configure GDPR mode", "tune memory performance",
  "change storage path", or "configure data cleanup". Provides interactive wizard
  for storage configuration with state detection.
license: MIT
metadata:
  version: 1.0.0
  author: SpillwaveSolutions
---
```

**Content Structure:**
1. Header section with purpose and when not to use
2. Quick Start table with commands: `/memory-storage`, `/memory-storage --minimal`, `/memory-storage --advanced`
3. Question Flow diagram (ASCII art showing 6 steps)
4. State Detection section with bash commands:
   - Check storage path: `grep -A5 '\[storage\]' ~/.config/memory-daemon/config.toml`
   - Check retention: `grep retention ~/.config/memory-daemon/config.toml`
   - Check disk usage: `du -sh ~/.memory-store && df -h ~/.memory-store | tail -1`
   - Check archive: `ls ~/.memory-archive`

5. **Six wizard steps with AskUserQuestion format:**

**Step 1: Storage Path**
- question: "Where should agent-memory store conversation data?"
- header: "Storage" (max 12 chars)
- options: ~/.memory-store (Recommended), ~/.local/share/agent-memory/db (XDG), Custom path
- Skip if: path configured AND not --fresh

**Step 2: Retention Policy**
- question: "How long should conversation data be retained?"
- header: "Retention"
- options: Forever (Recommended), 90 days, 30 days, 7 days
- Skip if: retention configured AND not --fresh

**Step 3: Cleanup Schedule** (--advanced only)
- question: "When should automatic cleanup run?"
- header: "Schedule"
- options: Daily at 3 AM (Recommended), Weekly on Sunday, Disabled, Custom cron
- Skip in --minimal mode

**Step 4: Archive Strategy** (--advanced only)
- question: "How should old data be archived before deletion?"
- header: "Archive"
- options: Compress to archive (Recommended), Export to JSON, No archive
- Skip in --minimal mode

**Step 5: GDPR Mode**
- question: "Enable GDPR-compliant deletion mode?"
- header: "GDPR"
- options: No (Recommended), Yes
- Show if: EU locale detected OR --advanced flag

**Step 6: Performance Tuning** (--advanced only)
- question: "Configure storage performance parameters?"
- header: "Performance"
- options: Balanced (64MB buffer, 4 jobs), Low memory (16MB, 1 job), High performance (128MB, 8 jobs), Custom
- Skip in --minimal mode

6. Config Generation section showing heredoc for config.toml updates
7. Validation section (path writable, 100MB minimum space, cron valid)
8. Output Formatting with [check]/[x] indicators
9. Reference Files links
10. Cross-skill navigation hints to /memory-llm and /memory-agents
  </action>
  <verify>
```bash
ls -la plugins/memory-setup-plugin/skills/memory-storage/SKILL.md
wc -l plugins/memory-setup-plugin/skills/memory-storage/SKILL.md
grep -c "AskUserQuestion\|question:" plugins/memory-setup-plugin/skills/memory-storage/SKILL.md
```
File exists, has 200+ lines, contains question definitions
  </verify>
  <done>SKILL.md exists with 6-step wizard flow, state detection, AskUserQuestion format, all three flag modes documented</done>
</task>

<task type="auto">
  <name>Task 2: Create retention-policies.md reference documentation</name>
  <files>plugins/memory-setup-plugin/skills/memory-storage/references/retention-policies.md</files>
  <action>
Create reference documentation for retention policies.

**Content:**
1. Overview of retention concept and why it matters
2. Policy options table:
   | Policy | Value | Storage Impact | Use Case |
   |--------|-------|----------------|----------|
   | Forever | `forever` | Grows unbounded | Maximum historical context |
   | 90 Days | `days:90` | ~3 months data | Balance of history and storage |
   | 30 Days | `days:30` | ~1 month data | Lower storage needs |
   | 7 Days | `days:7` | ~1 week data | Short-term memory only |

3. Cleanup Schedule section:
   - Default: `0 3 * * *` (daily at 3 AM)
   - Options with cron examples
   - Cron format explanation

4. Data Lifecycle diagram (ASCII):
   - Event ingested -> Active storage -> Retention period elapsed -> Archived/Deleted

5. Storage estimation table:
   - Typical usage patterns and size estimates
   - Formula: ~10KB per conversation turn average

6. Configuration example with config.toml snippet
  </action>
  <verify>
```bash
ls -la plugins/memory-setup-plugin/skills/memory-storage/references/retention-policies.md
grep -c "Policy\|forever\|days:" plugins/memory-setup-plugin/skills/memory-storage/references/retention-policies.md
```
File exists, contains policy options
  </verify>
  <done>retention-policies.md documents all retention options with storage impact estimates</done>
</task>

<task type="auto">
  <name>Task 3: Create gdpr-compliance.md and archive-strategies.md references</name>
  <files>
plugins/memory-setup-plugin/skills/memory-storage/references/gdpr-compliance.md
plugins/memory-setup-plugin/skills/memory-storage/references/archive-strategies.md
  </files>
  <action>
**Create gdpr-compliance.md:**
1. What GDPR mode enables:
   - Complete data removal (no tombstones)
   - Audit logging of deletions
   - Export-before-delete option
   - Right to erasure support

2. When to enable:
   - EU users or EU data subjects
   - Compliance requirements
   - Privacy-first deployments

3. Trade-offs table:
   | Aspect | Standard Mode | GDPR Mode |
   |--------|---------------|-----------|
   | Deletion | Tombstones | Complete removal |
   | Audit | Optional | Required |
   | Recovery | Possible | Not possible |

4. Configuration example

**Create archive-strategies.md:**
1. Archive strategy options:
   - Compress: gzip to ~/.memory-archive/
   - JSON export: human-readable backup
   - No archive: direct deletion (irreversible)

2. Archive location and format
3. Recovery procedures for each strategy
4. Disk space considerations
5. Configuration examples
  </action>
  <verify>
```bash
ls -la plugins/memory-setup-plugin/skills/memory-storage/references/
wc -l plugins/memory-setup-plugin/skills/memory-storage/references/*.md
```
Both files exist with appropriate content
  </verify>
  <done>gdpr-compliance.md and archive-strategies.md created with detailed documentation</done>
</task>

</tasks>

<verification>
Run these commands to verify the plan is complete:

```bash
# Verify directory structure
ls -la plugins/memory-setup-plugin/skills/memory-storage/
ls -la plugins/memory-setup-plugin/skills/memory-storage/references/

# Verify SKILL.md structure
grep -E "^---$|^name:|question:|header:|options:" plugins/memory-setup-plugin/skills/memory-storage/SKILL.md | head -30

# Verify reference docs
head -20 plugins/memory-setup-plugin/skills/memory-storage/references/retention-policies.md
head -20 plugins/memory-setup-plugin/skills/memory-storage/references/gdpr-compliance.md
head -20 plugins/memory-setup-plugin/skills/memory-storage/references/archive-strategies.md

# Count lines
wc -l plugins/memory-setup-plugin/skills/memory-storage/SKILL.md
wc -l plugins/memory-setup-plugin/skills/memory-storage/references/*.md
```
</verification>

<success_criteria>
1. SKILL.md has valid YAML frontmatter with name: memory-storage
2. Six wizard steps documented with AskUserQuestion format
3. State detection commands for checking existing config
4. Three flag modes (--minimal, --advanced, --fresh) documented
5. Three reference files created (retention, gdpr, archive)
6. Output formatting matches memory-setup patterns
7. Cross-skill navigation hints included
</success_criteria>

<output>
After completion, create `.planning/phases/15-configuration-wizard-skills/15-01-SUMMARY.md`
</output>
