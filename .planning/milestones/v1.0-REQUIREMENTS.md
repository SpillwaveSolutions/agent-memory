# Requirements Archive: v1.0 MVP

**Archived:** 2026-01-30
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v1 Requirements

Requirements for initial release. All complete.

### Storage

- [x] **STOR-01**: Append-only event storage with time-prefixed keys (`evt:{ts}:{ulid}`)
- [x] **STOR-02**: RocksDB column family isolation (events, toc_nodes, toc_latest, grips, outbox, checkpoints)
- [x] **STOR-03**: Checkpoint-based crash recovery for background jobs
- [x] **STOR-04**: Per-project RocksDB instances (one store per project directory)
- [x] **STOR-05**: FIFO or Universal compaction for append-only workload
- [x] **STOR-06**: Configurable multi-agent mode (unified store with tags OR separate stores)

### TOC Hierarchy

- [x] **TOC-01**: Full time hierarchy (Year -> Month -> Week -> Day -> Segment)
- [x] **TOC-02**: TOC nodes store title, bullets, keywords, child_node_ids
- [x] **TOC-03**: Segment creation on time threshold (30 min) or token threshold (4K)
- [x] **TOC-04**: Segment overlap for context continuity (5 min or 500 tokens)
- [x] **TOC-05**: Day/Week/Month rollup jobs with checkpointing
- [x] **TOC-06**: Versioned TOC nodes (append new version, don't mutate)

### Grips (Provenance)

- [x] **GRIP-01**: Grip struct with excerpt, event_id_start, event_id_end, timestamp, source
- [x] **GRIP-02**: TOC node bullets link to supporting grips
- [x] **GRIP-03**: Grips stored in dedicated column family
- [x] **GRIP-04**: ExpandGrip returns context events around excerpt

### Summarization

- [x] **SUMM-01**: Pluggable Summarizer trait (async, supports API and local LLM)
- [x] **SUMM-02**: Summarizer generates title, bullets, keywords from events
- [x] **SUMM-03**: Summarizer extracts grips as evidence for bullets
- [x] **SUMM-04**: Rollup summarizer aggregates child node summaries

### Ingestion

- [x] **ING-01**: gRPC IngestEvent RPC accepts Event message
- [x] **ING-02**: Event includes session_id, timestamp, role, text, metadata
- [x] **ING-03**: Idempotent writes using event_id as key
- [x] **ING-04**: Source timestamp used for ordering (not ingestion time)
- [x] **ING-05**: Outbox entry written atomically with event (for future index updates)

### Query

- [x] **QRY-01**: GetTocRoot RPC returns top-level time nodes
- [x] **QRY-02**: GetNode RPC returns node with children and summary
- [x] **QRY-03**: BrowseToc RPC supports pagination of children
- [x] **QRY-04**: GetEvents RPC retrieves raw events by time range
- [x] **QRY-05**: ExpandGrip RPC retrieves context around grip excerpt

### gRPC Service

- [x] **GRPC-01**: Memory daemon exposes gRPC service (tonic)
- [x] **GRPC-02**: Proto definitions for Event, TocNode, Grip, all RPCs
- [x] **GRPC-03**: Health check endpoint (tonic-health)
- [x] **GRPC-04**: Reflection endpoint for debugging (tonic-reflection)

### Hook Handler Integration

- [x] **HOOK-01**: code_agent_context_hooks repo provides hook handlers
- [x] **HOOK-02**: Hook handlers call daemon's IngestEvent RPC
- [x] **HOOK-03**: Event types map 1:1 from hook events (SessionStart, UserPromptSubmit, PostToolUse, Stop, etc.)

### Configuration

- [x] **CFG-01**: Layered config: defaults -> config file -> env vars -> CLI flags
- [x] **CFG-02**: Config includes: db_path, grpc_port, summarizer settings
- [x] **CFG-03**: Config file location: ~/.config/agent-memory/config.toml

### CLI

- [x] **CLI-01**: Memory daemon binary with start/stop/status commands
- [x] **CLI-02**: Query CLI for manual TOC navigation and testing
- [x] **CLI-03**: Admin commands: rebuild-toc, compact, status

### CCH Integration (Phase 7-8)

- [x] **CCH-01**: Memory-ingest binary that CCH can invoke via `run` action
- [x] **CCH-02**: Event mapping from CCH events to memory events
- [x] **CCH-03**: hooks.yaml template for agent-memory integration

### Agentic Memory Query Skill (Phase 7)

- [x] **SKILL-01**: Claude Code skill with commands: /memory-search, /memory-recent, /memory-context
- [x] **SKILL-02**: Skill uses memory-client library to communicate with daemon
- [x] **SKILL-03**: Skill navigates TOC, expands grips, formats results for agent context

---

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| STOR-01 through STOR-06 | Phase 1 | ✅ Complete |
| ING-01 through ING-05 | Phase 1 | ✅ Complete |
| GRPC-01 through GRPC-04 | Phase 1 | ✅ Complete |
| CFG-01 through CFG-03 | Phase 1 | ✅ Complete |
| CLI-01 | Phase 1 | ✅ Complete |
| TOC-01 through TOC-06 | Phase 2 | ✅ Complete |
| SUMM-01, SUMM-02, SUMM-04 | Phase 2 | ✅ Complete |
| GRIP-01 through GRIP-04 | Phase 3 | ✅ Complete |
| SUMM-03 | Phase 3 | ✅ Complete |
| QRY-01 through QRY-05 | Phase 4 | ✅ Complete |
| HOOK-02, HOOK-03 | Phase 5 | ✅ Complete |
| CLI-02, CLI-03 | Phase 5 | ✅ Complete |
| SKILL-01 through SKILL-03 | Phase 7 | ✅ Complete |
| CCH-01 through CCH-03 | Phase 8 | ✅ Complete |

---

## Milestone Summary

**Shipped:** 50 of 50 requirements (100%)

**Coverage:**
- v1 core requirements: 42 (all complete)
- Plugin requirements: 5 (all complete)
- CCH requirements: 3 (all complete)

**Adjusted during implementation:** None
**Dropped:** None

---
*Archived: 2026-01-30 as part of v1.0.0 milestone completion*
