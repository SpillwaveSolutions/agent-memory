syntax = "proto3";

package memory;

// Memory service for agent conversation storage.
//
// This service provides:
// - Event ingestion for conversation capture
// - Health check for monitoring
// - Reflection for debugging
service MemoryService {
    // Ingest a conversation event.
    //
    // Events are persisted to RocksDB with time-prefixed keys.
    // Idempotent: returns created=false if event_id already exists.
    rpc IngestEvent(IngestEventRequest) returns (IngestEventResponse);
}

// Role of the message author
enum EventRole {
    EVENT_ROLE_UNSPECIFIED = 0;
    EVENT_ROLE_USER = 1;
    EVENT_ROLE_ASSISTANT = 2;
    EVENT_ROLE_SYSTEM = 3;
    EVENT_ROLE_TOOL = 4;
}

// Type of conversation event
enum EventType {
    EVENT_TYPE_UNSPECIFIED = 0;
    EVENT_TYPE_SESSION_START = 1;
    EVENT_TYPE_USER_MESSAGE = 2;
    EVENT_TYPE_ASSISTANT_MESSAGE = 3;
    EVENT_TYPE_TOOL_RESULT = 4;
    EVENT_TYPE_ASSISTANT_STOP = 5;
    EVENT_TYPE_SUBAGENT_START = 6;
    EVENT_TYPE_SUBAGENT_STOP = 7;
    EVENT_TYPE_SESSION_END = 8;
}

// A conversation event to be stored.
//
// Per ING-02: Includes session_id, timestamp, role, text, metadata.
message Event {
    // Unique identifier (ULID string, generated by client)
    string event_id = 1;

    // Session this event belongs to
    string session_id = 2;

    // Source timestamp in milliseconds since Unix epoch.
    // Per ING-04: Used for ordering, not ingestion time.
    int64 timestamp_ms = 3;

    // Type of event
    EventType event_type = 4;

    // Role of the author
    EventRole role = 5;

    // Event content/text
    string text = 6;

    // Additional metadata (tool names, file paths, etc.)
    map<string, string> metadata = 7;
}

// Request to ingest an event
message IngestEventRequest {
    // The event to ingest
    Event event = 1;
}

// Response from event ingestion
message IngestEventResponse {
    // The event_id that was stored
    string event_id = 1;

    // True if event was newly created, false if already existed (idempotent)
    bool created = 2;
}
